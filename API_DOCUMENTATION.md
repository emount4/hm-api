# API Документация

**Базовый URL:** `http://localhost:8080`

**Версия API:** v1

---

## Содержание

1. [Аутентификация](#аутентификация)
2. [Профиль пользователя](#профиль-пользователя)
3. [Объявления клиента](#объявления-клиента)
4. [Мастера (Handyman)](#мастера-handyman)
5. [Категории мастеров](#категории-мастеров)
6. [Справочная информация](#справочная-информация)

---

## Общая информация

### Форматы данных
- Все запросы и ответы используют формат **JSON**
- Кодировка: **UTF-8**
- Content-Type: `application/json`

### Аутентификация
Защищённые эндпоинты требуют JWT токен в заголовке:
```
Authorization: Bearer <ваш_токен>
```

### Коды ответов
- `200` - Успешный запрос
- `201` - Ресурс успешно создан
- `400` - Некорректный запрос
- `401` - Не авторизован
- `403` - Доступ запрещён
- `404` - Ресурс не найден
- `405` - Метод не разрешён
- `409` - Конфликт (например, пользователь уже существует)
- `500` - Внутренняя ошибка сервера

---

## Аутентификация

### Регистрация
Создание нового пользователя в системе.

**Endpoint:** `POST /auth/register`

**Требуется авторизация:** Нет

**Тело запроса:**
```json
{
  "email": "user@example.com",
  "name": "Иван Иванов",
  "password": "securePassword123",
  "role": 1
}
```

**Поля:**
- `email` (string, обязательно) - Email пользователя
- `name` (string, обязательно) - Имя пользователя
- `password` (string, обязательно) - Пароль
- `role` (uint, обязательно) - ID роли (1 - клиент, 2 - мастер)

**Ответ (201):**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "email": "user@example.com",
    "role": "client"
  }
}
```

**Ошибки:**
- `400` - Некорректные данные
- `409` - Пользователь с таким email уже существует

---

### Вход
Аутентификация существующего пользователя.

**Endpoint:** `POST /auth/login`

**Требуется авторизация:** Нет

**Тело запроса:**
```json
{
  "email": "user@example.com",
  "password": "securePassword123"
}
```

**Ответ (200):**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "email": "user@example.com",
    "role": "client"
  }
}
```

**Ошибки:**
- `400` - Некорректный JSON
- `401` - Неверные учётные данные

---

## Профиль пользователя

### Получить профиль
Получение информации о текущем пользователе.

**Endpoint:** `GET /profile`

**Требуется авторизация:** Да

**Ответ (200):**
```json
{
  "id": 1,
  "email": "user@example.com",
  "role": "client",
  "name": "Иван Иванов",
  "phone": "+7 (123) 456-78-90",
  "have_worker_profile": true,
  "worker": {
    "specialization": [
      {"id": 1, "name": "Сантехника"},
      {"id": 2, "name": "Электрика"}
    ],
    "experience": 5,
    "description": "Опытный мастер",
    "is_busy": false,
    "location": "Москва",
    "schedule": "Пн-Пт 9:00-18:00"
  }
}
```

**Примечание:** Поле `worker` присутствует только если `have_worker_profile: true`

---

### Обновить профиль
Редактирование профиля пользователя и/или профиля мастера.

**Endpoint:** `PATCH /profile`

**Требуется авторизация:** Да

**Тело запроса:**
```json
{
  "name": "Иван Петрович Иванов",
  "phone": "+7 (987) 654-32-10",
  "exp_years": 7,
  "description": "Специализируюсь на сложных работах",
  "is_busy": false,
  "location": "Москва, СВАО",
  "schedule": "Пн-Сб 8:00-20:00",
  "category_names": ["Сантехника", "Электрика", "Ремонт квартир"]
}
```

**Поля (все опциональны):**
- `name` (string) - Имя пользователя
- `phone` (string) - Телефон
- `exp_years` (int) - Опыт работы в годах
- `description` (string) - Описание мастера
- `is_busy` (bool) - Занятость мастера
- `location` (string) - Локация/район работы
- `schedule` (string) - График работы
- `category_names` ([]string) - Категории услуг (полная замена)

**Ответ (200):**
```json
{
  "message": "Profile updated successfully",
  "profile": {
    "id": 1,
    "email": "user@example.com",
    "name": "Иван Петрович Иванов",
    "phone": "+7 (987) 654-32-10",
    "have_worker_profile": true,
    "worker": {
      "specialization": [
        {"id": 1, "name": "Сантехника"},
        {"id": 2, "name": "Электрика"},
        {"id": 5, "name": "Ремонт квартир"}
      ],
      "experience": 7,
      "description": "Специализируюсь на сложных работах",
      "is_busy": false,
      "location": "Москва, СВАО",
      "schedule": "Пн-Сб 8:00-20:00"
    }
  }
}
```

---

## Объявления клиента

### Получить список объявлений (публичный)
Получение списка всех объявлений с фильтрацией и пагинацией.

**Endpoint:** `GET /ads`

**Требуется авторизация:** Нет

**Query параметры:**
- `limit` (int, default: 10) - Количество результатов на странице
- `offset` (int, default: 0) - Смещение для пагинации
- `category` (string) - Фильтр по категории (поиск по названию)
- `location` (string) - Фильтр по локации

**Пример запроса:**
```
GET /ads?limit=5&offset=0&category=Сантехника&location=Москва
```

**Ответ (200):**
```json
{
  "ads": [
    {
      "id": 1,
      "title": "Требуется сантехник",
      "price": 3000.00,
      "location": "Москва, СВАО",
      "category": {
        "id": 1,
        "name": "Сантехника"
      },
      "user": {
        "id": 5,
        "name": "Петр Петров"
      },
      "created_at": "2026-02-20T10:30:00Z"
    }
  ],
  "total": 25,
  "limit": 5,
  "offset": 0
}
```

---

### Получить объявление по ID (личное)
Получение конкретного объявления текущего пользователя.

**Endpoint:** `GET /my-ads/{adID}`

**Требуется авторизация:** Да

**Параметры URL:**
- `adID` (uint) - ID объявления

**Ответ (200):**
```json
{
  "id": 1,
  "title": "Требуется сантехник",
  "price": 3000.00,
  "category_id": 1,
  "price_unit_id": 1,
  "user_id": 5,
  "location": "Москва, СВАО",
  "schedule": "Срочно, в течение недели",
  "created_at": "2026-02-20T10:30:00Z",
  "category": {
    "id": 1,
    "name": "Сантехника"
  },
  "price_unit": {
    "id": 1,
    "name": "за работу"
  },
  "user": {
    "id": 5,
    "name": "Петр Петров",
    "email": "petr@example.com"
  }
}
```

**Ошибки:**
- `404` - Объявление не найдено

---

### Создать объявление
Создание нового объявления клиентом.

**Endpoint:** `POST /my-ads/`

**Требуется авторизация:** Да

**Тело запроса:**
```json
{
  "title": "Требуется электрик для замены проводки",
  "price": 15000.00,
  "category_id": 2,
  "price_unit_id": 1,
  "location": "Москва, Центральный район",
  "schedule": "В феврале-марте 2026, гибкий график"
}
```

**Поля:**
- `title` (string, обязательно) - Название объявления
- `price` (float64, обязательно) - Цена (должна быть > 0)
- `category_id` (uint, обязательно) - ID категории услуги
- `price_unit_id` (uint, обязательно) - ID единицы измерения цены
- `location` (string) - Локация выполнения работ
- `schedule` (string) - График/сроки выполнения

**Ответ (201):**
```json
{
  "id": 42,
  "title": "Требуется электрик для замены проводки",
  "price": 15000.00,
  "category_id": 2,
  "price_unit_id": 1,
  "user_id": 5,
  "location": "Москва, Центральный район",
  "schedule": "В феврале-марте 2026, гибкий график",
  "created_at": "2026-02-27T14:25:00Z",
  "category": {
    "id": 2,
    "name": "Электрика"
  },
  "price_unit": {
    "id": 1,
    "name": "за работу"
  },
  "user": {
    "id": 5,
    "name": "Петр Петров",
    "email": "petr@example.com"
  }
}
```

**Ошибки:**
- `400` - Некорректные данные
- `404` - Категория или единица измерения не найдены

---

### Обновить объявление
Редактирование существующего объявления.

**Endpoint:** `PATCH /my-ads/{adID}`

**Требуется авторизация:** Да

**Параметры URL:**
- `adID` (uint) - ID объявления

**Тело запроса (все поля опциональны):**
```json
{
  "title": "Требуется опытный электрик",
  "price": 18000.00,
  "category_id": 2,
  "price_unit_id": 2,
  "location": "Москва, ЦАО, м. Маяковская",
  "schedule": "С 1 по 15 марта 2026"
}
```

**Поля (все опциональны):**
- `title` (string) - Новое название
- `price` (float64) - Новая цена (должна быть > 0)
- `category_id` (uint) - Новая категория
- `price_unit_id` (uint) - Новая единица измерения
- `location` (string) - Новая локация
- `schedule` (string) - Новый график

**Ответ (200):**
```json
{
  "id": 42,
  "title": "Требуется опытный электрик",
  "price": 18000.00,
  "category_id": 2,
  "price_unit_id": 2,
  "user_id": 5,
  "location": "Москва, ЦАО, м. Маяковская",
  "schedule": "С 1 по 15 марта 2026",
  "created_at": "2026-02-27T14:25:00Z",
  "category": {
    "id": 2,
    "name": "Электрика"
  },
  "price_unit": {
    "id": 2,
    "name": "за час"
  },
  "user": {
    "id": 5,
    "name": "Петр Петров",
    "email": "petr@example.com"
  }
}
```

**Ошибки:**
- `400` - Некорректные данные или нет полей для обновления
- `404` - Объявление не найдено или нет доступа

---

### Удалить объявление
Удаление объявления (мягкое удаление).

**Endpoint:** `DELETE /my-ads/{adID}`

**Требуется авторизация:** Да

**Параметры URL:**
- `adID` (uint) - ID объявления

**Ответ (200):**
```json
{
  "message": "ad deleted successfully"
}
```

**Ошибки:**
- `404` - Объявление не найдено или нет доступа

---

## Мастера (Handyman)

### Получить список мастеров
Получение списка всех активных мастеров с пагинацией.

**Endpoint:** `GET /handyman`

**Требуется авторизация:** Нет

**Query параметры:**
- `limit` (int, default: 10) - Количество результатов
- `offset` (int, default: 0) - Смещение для пагинации

**Пример запроса:**
```
GET /handyman?limit=20&offset=0
```

**Ответ (200):**
```json
{
  "workers": [
    {
      "id": 3,
      "name": "Сергей Мастеров",
      "email": "sergey@example.com",
      "phone": "+7 (111) 222-33-44",
      "categories": [
        {"id": 1, "name": "Сантехника"},
        {"id": 2, "name": "Электрика"}
      ],
      "exp_years": 8,
      "description": "Качественный ремонт, гарантия",
      "is_busy": false,
      "location": "Москва, ЮАО",
      "schedule": "Ежедневно 8:00-22:00"
    }
  ],
  "pagination": {
    "total": 45,
    "limit": 20,
    "offset": 0,
    "page": 1,
    "pages": 3
  }
}
```

---

### Получить мастера по ID
Получение детальной информации о конкретном мастере.

**Endpoint:** `GET /handyman/{id}`

**Требуется авторизация:** Нет

**Параметры URL:**
- `id` (uint) - ID мастера (user_id)

**Ответ (200):**
```json
{
  "id": 3,
  "name": "Сергей Мастеров",
  "email": "sergey@example.com",
  "phone": "+7 (111) 222-33-44",
  "categories": [
    {"id": 1, "name": "Сантехника"},
    {"id": 2, "name": "Электрика"}
  ],
  "exp_years": 8,
  "description": "Качественный ремонт, гарантия на все работы. Работаю с материалами заказчика и своими.",
  "is_busy": false,
  "location": "Москва, ЮАО, район Чертаново",
  "schedule": "Ежедневно 8:00-22:00"
}
```

**Ошибки:**
- `400` - Некорректный ID
- `404` - Мастер не найден

---

## Категории мастеров

Управление категориями услуг для текущего мастера.

### Получить мои категории
Получение списка категорий текущего мастера.

**Endpoint:** `GET /handyman/categories`

**Требуется авторизация:** Да

**Ответ (200):**
```json
[
  {"id": 1, "name": "Сантехника"},
  {"id": 2, "name": "Электрика"},
  {"id": 5, "name": "Ремонт квартир"}
]
```

**Ошибки:**
- `403` - Профиль мастера не найден

---

### Добавить категории
Добавление новых категорий к профилю мастера.

**Endpoint:** `POST /handyman/categories`

**Требуется авторизация:** Да

**Тело запроса:**
```json
{
  "category_names": ["Плотницкие работы", "Малярные работы"]
}
```

**Ответ (200):**
```json
[
  {"id": 1, "name": "Сантехника"},
  {"id": 2, "name": "Электрика"},
  {"id": 5, "name": "Ремонт квартир"},
  {"id": 7, "name": "Плотницкие работы"},
  {"id": 9, "name": "Малярные работы"}
]
```

**Ошибки:**
- `400` - Категория не найдена
- `403` - Профиль мастера не найден

---

### Удалить категории
Удаление категорий из профиля мастера.

**Endpoint:** `DELETE /handyman/categories`

**Требуется авторизация:** Да

**Тело запроса:**
```json
{
  "category_names": ["Плотницкие работы"]
}
```

**Ответ (200):**
```json
[
  {"id": 1, "name": "Сантехника"},
  {"id": 2, "name": "Электрика"},
  {"id": 5, "name": "Ремонт квартир"},
  {"id": 9, "name": "Малярные работы"}
]
```

**Ошибки:**
- `400` - Категория не найдена
- `403` - Профиль мастера не найден

---

## Справочная информация

### Получить список категорий
Получение всех доступных категорий услуг.

**Endpoint:** `GET /info/categories`

**Требуется авторизация:** Нет

**Ответ (200):**
```json
[
  {"id": 1, "name": "Сантехника"},
  {"id": 2, "name": "Электрика"},
  {"id": 3, "name": "Отделочные работы"},
  {"id": 4, "name": "Клининг"},
  {"id": 5, "name": "Ремонт квартир"},
  {"id": 6, "name": "Ремонт бытовой техники"},
  {"id": 7, "name": "Плотницкие работы"},
  {"id": 8, "name": "Кровельные работы"},
  {"id": 9, "name": "Малярные работы"}
]
```

---

## Примеры использования

### Пример 1: Регистрация и создание объявления

```bash
# 1. Регистрация клиента
curl -X POST http://localhost:8080/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "client@example.com",
    "name": "Иван Клиентов",
    "password": "password123",
    "role": 1
  }'

# Ответ: {"token": "eyJhbGc...", "user": {...}}

# 2. Создание объявления
curl -X POST http://localhost:8080/my-ads/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGc..." \
  -d '{
    "title": "Установка смесителя",
    "price": 2000,
    "category_id": 1,
    "price_unit_id": 1,
    "location": "Москва, Южное Бутово"
  }'
```

### Пример 2: Регистрация мастера и настройка профиля

```bash
# 1. Регистрация мастера
curl -X POST http://localhost:8080/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "master@example.com",
    "name": "Сергей Мастеров",
    "password": "secure456",
    "role": 2
  }'

# 2. Обновление профиля мастера
curl -X PATCH http://localhost:8080/profile \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGc..." \
  -d '{
    "phone": "+7 (999) 888-77-66",
    "exp_years": 10,
    "description": "Профессиональный мастер",
    "location": "Москва, ЮВАО",
    "schedule": "Пн-Пт 9:00-18:00",
    "category_names": ["Сантехника", "Электрика"]
  }'
```

### Пример 3: Поиск объявлений

```bash
# Поиск объявлений по категории и локации
curl -X GET "http://localhost:8080/ads?category=Сантехника&location=Москва&limit=10&offset=0"
```

---

## Модели данных

### User (Пользователь)
```json
{
  "id": "uint",
  "name": "string",
  "email": "string",
  "role_id": "uint",
  "phone": "string",
  "created_at": "timestamp"
}
```

### Ad (Объявление)
```json
{
  "id": "uint",
  "title": "string",
  "price": "float64",
  "category_id": "uint",
  "price_unit_id": "uint",
  "user_id": "uint",
  "location": "string",
  "schedule": "string",
  "created_at": "timestamp"
}
```

### WorkerProfile (Профиль мастера)
```json
{
  "user_id": "uint",
  "exp_years": "int",
  "description": "string",
  "is_busy": "bool",
  "location": "string",
  "schedule": "string",
  "have_worker_profile": "bool"
}
```

### Category (Категория)
```json
{
  "id": "uint",
  "name": "string"
}
```

---

## Примечания

1. **Токены JWT** действительны в течение времени, указанного в конфигурации сервера
2. **Мягкое удаление**: Объявления удаляются с использованием soft delete (GORM)
3. **Пагинация**: По умолчанию возвращается 10 элементов, максимум можно запросить через параметр `limit`
4. **Поиск**: Поиск по категориям и локации использует ILIKE (регистронезависимый)
5. **Роли пользователей**:
   - `1` - Клиент (может создавать объявления)
   - `2` - Мастер (может предоставлять услуги)
6. **WorkerProfile создаётся автоматически** при регистрации любого пользователя

---

## Контакты и поддержка

Для вопросов по API обращайтесь к разработчику проекта.

**Дата последнего обновления:** 27 февраля 2026
